<!DOCTYPE html><html><head>
      <title>LIYUSU</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="file:///c:\Users\15292\.vscode\extensions\shd101wyy.markdown-preview-enhanced-0.6.1\node_modules\@shd101wyy\mume\dependencies\katex\katex.min.css">
      
      
      
      
      
      
      
      
      
      <style>
      /**
 * prism.js Github theme based on GitHub's theme.
 * @author Sam Clarke
 */
code[class*="language-"],
pre[class*="language-"] {
  color: #333;
  background: none;
  font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.4;

  -moz-tab-size: 8;
  -o-tab-size: 8;
  tab-size: 8;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

/* Code blocks */
pre[class*="language-"] {
  padding: .8em;
  overflow: auto;
  /* border: 1px solid #ddd; */
  border-radius: 3px;
  /* background: #fff; */
  background: #f5f5f5;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
  padding: .1em;
  border-radius: .3em;
  white-space: normal;
  background: #f5f5f5;
}

.token.comment,
.token.blockquote {
  color: #969896;
}

.token.cdata {
  color: #183691;
}

.token.doctype,
.token.punctuation,
.token.variable,
.token.macro.property {
  color: #333;
}

.token.operator,
.token.important,
.token.keyword,
.token.rule,
.token.builtin {
  color: #a71d5d;
}

.token.string,
.token.url,
.token.regex,
.token.attr-value {
  color: #183691;
}

.token.property,
.token.number,
.token.boolean,
.token.entity,
.token.atrule,
.token.constant,
.token.symbol,
.token.command,
.token.code {
  color: #0086b3;
}

.token.tag,
.token.selector,
.token.prolog {
  color: #63a35c;
}

.token.function,
.token.namespace,
.token.pseudo-element,
.token.class,
.token.class-name,
.token.pseudo-class,
.token.id,
.token.url-reference .token.variable,
.token.attr-name {
  color: #795da3;
}

.token.entity {
  cursor: help;
}

.token.title,
.token.title .token.punctuation {
  font-weight: bold;
  color: #1d3e81;
}

.token.list {
  color: #ed6a43;
}

.token.inserted {
  background-color: #eaffea;
  color: #55a532;
}

.token.deleted {
  background-color: #ffecec;
  color: #bd2c00;
}

.token.bold {
  font-weight: bold;
}

.token.italic {
  font-style: italic;
}


/* JSON */
.language-json .token.property {
  color: #183691;
}

.language-markup .token.tag .token.punctuation {
  color: #333;
}

/* CSS */
code.language-css,
.language-css .token.function {
  color: #0086b3;
}

/* YAML */
.language-yaml .token.atrule {
  color: #63a35c;
}

code.language-yaml {
  color: #183691;
}

/* Ruby */
.language-ruby .token.function {
  color: #333;
}

/* Markdown */
.language-markdown .token.url {
  color: #795da3;
}

/* Makefile */
.language-makefile .token.symbol {
  color: #795da3;
}

.language-makefile .token.variable {
  color: #183691;
}

.language-makefile .token.builtin {
  color: #0086b3;
}

/* Bash */
.language-bash .token.keyword {
  color: #0086b3;
}

/* highlight */
pre[data-line] {
  position: relative;
  padding: 1em 0 1em 3em;
}
pre[data-line] .line-highlight-wrapper {
  position: absolute;
  top: 0;
  left: 0;
  background-color: transparent;
  display: block;
  width: 100%;
}

pre[data-line] .line-highlight {
  position: absolute;
  left: 0;
  right: 0;
  padding: inherit 0;
  margin-top: 1em;
  background: hsla(24, 20%, 50%,.08);
  background: linear-gradient(to right, hsla(24, 20%, 50%,.1) 70%, hsla(24, 20%, 50%,0));
  pointer-events: none;
  line-height: inherit;
  white-space: pre;
}

pre[data-line] .line-highlight:before, 
pre[data-line] .line-highlight[data-end]:after {
  content: attr(data-start);
  position: absolute;
  top: .4em;
  left: .6em;
  min-width: 1em;
  padding: 0 .5em;
  background-color: hsla(24, 20%, 50%,.4);
  color: hsl(24, 20%, 95%);
  font: bold 65%/1.5 sans-serif;
  text-align: center;
  vertical-align: .3em;
  border-radius: 999px;
  text-shadow: none;
  box-shadow: 0 1px white;
}

pre[data-line] .line-highlight[data-end]:after {
  content: attr(data-end);
  top: auto;
  bottom: .4em;
}html body{font-family:"Helvetica Neue",Helvetica,"Segoe UI",Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ul,html body>ol{margin-bottom:16px}html body ul,html body ol{padding-left:2em}html body ul.no-list,html body ol.no-list{padding:0;list-style-type:none}html body ul ul,html body ul ol,html body ol ol,html body ol ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:bold;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:bold}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em !important;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::before,html body code::after{letter-spacing:-0.2em;content:"\00a0"}html body pre>code{padding:0;margin:0;font-size:.85em !important;word-break:normal;white-space:pre;background:transparent;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;font-size:.85em !important;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:before,html body pre tt:before,html body pre code:after,html body pre tt:after{content:normal}html body p,html body blockquote,html body ul,html body ol,html body dl,html body pre{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body pre,html body code{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview .pagebreak,.markdown-preview .newpage{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center !important}.markdown-preview:not([for="preview"]) .code-chunk .btn-group{display:none}.markdown-preview:not([for="preview"]) .code-chunk .status{display:none}.markdown-preview:not([for="preview"]) .code-chunk .output-div{margin-bottom:16px}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0}@media screen and (min-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{font-size:14px !important;padding:1em}}@media print{html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,0.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul{padding:0 1.6em;margin-top:.8em}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc li{margin-bottom:.8em}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul{list-style-type:none}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% -  300px);padding:2em calc(50% - 457px -  150px);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */

      </style>
    </head>
    <body for="html-export">
      <div class="mume markdown-preview  ">
      <h1 class="mume-header" id="final-assignment">final assignment</h1>

<h2 class="mume-header" id="global">global</h2>

<p>we firstly used<code>&gt;Rscript getdata.R</code>to get &apos;dat.csv&apos; from &apos;data_cn/tickers.csv&apos; , &apos;data_cn/adjusted.csv&apos; and &apos;data_cn/in_univ.csv&apos; , all what we use is in &apos;dat.csv&apos; , later all the code is start from dat.csv . during this step , we remove those don&apos;t have Gics code from our universe.</p>
<p>we write all the functions to modify data in &apos;calculate.r&apos;</p>
<p>we write all the <code>library()</code> in &apos;library.r&apos;</p>
<h2 class="mume-header" id="part-a">part A</h2>

<h3 class="mume-header" id="1">1.</h3>

<p>we first choose a specific year t . Then we remove those stocks don&apos;t exist in this year , for 21_day_lookback factor , we chose the timeseries from 21days before that year</p>
<p>we write this step in &apos;yeardat.r&apos; , as an example , we choose 2018 and the data is saved in test18.csv .</p>
<h3 class="mume-header" id="2">2.</h3>

<p>we firstly write some functions in file &apos;calculate.r&apos;</p>
<ul>
<li><code>app(dat,tau,f)</code> , apply function <code>f</code> to past <code>tau</code> days in every time series in <code>dat</code> . use the result to constructure a data.frame derive the timesreies in this year</li>
<li><code>logreturn()</code>  to change the  data in the specific year to daily log return .</li>
<li><code>minus()</code> subtract out the industry mean</li>
<li><code>mat()</code> change the data.frame to matrix purely derive values(don&apos;t contain Gics , date , etc.)</li>
<li><code>ran()</code> return the rank :<br>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mo stretchy="false">(</mo><mn>2</mn><mo>&#x2217;</mo><mi>r</mi><mi>a</mi><mi>n</mi><mi>k</mi><mo>&#x2212;</mo><mi>N</mi><mo>&#x2212;</mo><mn>1</mn><mo stretchy="false">)</mo><mi mathvariant="normal">/</mi><mo stretchy="false">(</mo><mi>N</mi><mo>&#x2212;</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(2*rank-N-1)/(N-1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">&#x2217;</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal" style="margin-right:0.03148em;">ank</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">&#x2212;</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">&#x2212;</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mord">/</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">&#x2212;</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span></span></li>
</ul>
<p>then we have these to get v :</p>
<pre data-role="codeBlock" data-info="R" class="language-r"><span class="token comment">#get the factor v</span>
<span class="token comment">#grt the daily logreturn , we change NA to 0 here</span>
logr <span class="token operator">=</span> logreturn<span class="token punctuation">(</span>year<span class="token punctuation">)</span>

<span class="token comment"># a)</span>
<span class="token comment">#get the 10-day-logreturn</span>
logr10 <span class="token operator">=</span> app<span class="token punctuation">(</span>logr<span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span>mean<span class="token punctuation">)</span>

<span class="token comment"># b)</span>
<span class="token comment">#subtract out the industry return</span>
logr_idu <span class="token operator">=</span> minus<span class="token punctuation">(</span>logr10<span class="token punctuation">)</span>

<span class="token comment"># c)</span>
<span class="token comment">#calculate the volatility </span>
<span class="token comment">#and then divide the 10-day return by the volatility </span>
sd21 <span class="token operator">=</span> app<span class="token punctuation">(</span>logr<span class="token punctuation">,</span><span class="token number">21</span><span class="token punctuation">,</span>sd<span class="token punctuation">)</span>
v <span class="token operator">=</span> mat<span class="token punctuation">(</span>logr_idu<span class="token punctuation">)</span><span class="token operator">/</span>mat<span class="token punctuation">(</span>sd21<span class="token punctuation">)</span>

<span class="token comment"># d</span>
<span class="token comment">#rank the normalized factor)</span>
v <span class="token operator">=</span> ran<span class="token punctuation">(</span>v<span class="token punctuation">)</span>
</pre><h3 class="mume-header" id="3">3.</h3>

<p>similar to 2. we have :</p>
<pre data-role="codeBlock" data-info="R" class="language-r"><span class="token comment"># a) </span>
<span class="token comment">#we already get that in 2. </span>
<span class="token comment">#logr is what we need</span>

<span class="token comment"># b)</span>
<span class="token comment">#subtract out the industry return</span>
logrm_idu <span class="token operator">=</span> minus<span class="token punctuation">(</span>logr<span class="token punctuation">)</span>

<span class="token comment"># c)</span>
<span class="token comment">#get the maximum of the magnitude of the daily return</span>
max21 <span class="token operator">=</span> app<span class="token punctuation">(</span>logrm_idu<span class="token punctuation">,</span><span class="token number">21</span><span class="token punctuation">,</span>max<span class="token punctuation">)</span>

<span class="token comment"># d)</span>
<span class="token comment">#rank the factor</span>
m <span class="token operator">=</span> ran<span class="token punctuation">(</span>mat<span class="token punctuation">(</span>max21<span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><h3 class="mume-header" id="4">4.</h3>

<p>we add a function to &apos;calculate.r&apos;</p>
<ul>
<li><code>regr(a,b,c)</code> , <code>a,b,c</code>are all <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>&#xD7;</mo><mi>j</mi></mrow><annotation encoding="application/x-tex">i&#xD7; j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.74285em;vertical-align:-0.08333em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">&#xD7;</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span> matrix this function return the <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>i</mi><mo>&#x2212;</mo><mn>1</mn><mo stretchy="false">)</mo><mo>&#xD7;</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">(i-1)&#xD7; 2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">&#x2212;</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">&#xD7;</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span></span></span></span> matrix <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>&#x3B2;</mi><mo>=</mo><mo stretchy="false">(</mo><msub><mi>&#x3B2;</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>b</mi></mrow></msub><mo separator="true">,</mo><msub><mi>&#x3B2;</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>c</mi></mrow></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">&#x3B2; = (\beta_{i,b} , \beta_{i,c})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.05278em;">&#x3B2;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05278em;">&#x3B2;</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.05278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">b</span></span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05278em;">&#x3B2;</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.05278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">c</span></span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></li>
</ul>
<p>then this step is:</p>
<pre data-role="codeBlock" data-info="R" class="language-r">   <span class="token comment">#calculate the daily betas</span>
   r_midu <span class="token operator">=</span> app<span class="token punctuation">(</span>logrm_idu<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>max<span class="token punctuation">)</span>
   beta <span class="token operator">=</span> regr<span class="token punctuation">(</span>mat<span class="token punctuation">(</span>r_midu<span class="token punctuation">)</span><span class="token punctuation">,</span>v<span class="token punctuation">,</span>m<span class="token punctuation">)</span>
   beta_v <span class="token operator">=</span> beta<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">]</span>
   beta_m <span class="token operator">=</span> beta<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">]</span>
</pre><h3 class="mume-header" id="5">5.</h3>

<p>we add a function to &apos;calculate.r&apos;</p>
<ul>
<li><code>ts(x)</code> return the t-stat of x</li>
</ul>
<p>then this step is:</p>
<pre data-role="codeBlock" data-info="R" class="language-r"><span class="token comment">#calculate the 1-year average and the t-stat of beta</span>
and the t<span class="token operator">-</span>stat
mbm <span class="token operator">=</span> mean<span class="token punctuation">(</span>beta_m<span class="token punctuation">)</span>
tsv <span class="token operator">=</span> ts<span class="token punctuation">(</span>beta_v<span class="token punctuation">)</span>
tsm <span class="token operator">=</span> ts<span class="token punctuation">(</span>beta_m<span class="token punctuation">)</span>
</pre><h3 class="mume-header" id="result">result</h3>

<p>we do a loop to apply the steps to every year , and save the results together to &apos;beta.csv&apos; , the that is:</p>
<table>
<thead>
<tr>
<th></th>
<th>tlist</th>
<th>mbv</th>
<th>mbm</th>
<th>tsv</th>
<th>tsm</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>10</td>
<td>3.17526016374988e-06</td>
<td>5.94493012403889e-05</td>
<td>0.00904250852186723</td>
<td>1.12802009177008</td>
</tr>
<tr>
<td>2</td>
<td>11</td>
<td>-0.000169546405459324</td>
<td>-1.40568680799672e-06</td>
<td>-0.743844427732674</td>
<td>-0.105738889544941</td>
</tr>
<tr>
<td>3</td>
<td>12</td>
<td>-0.000337121878928585</td>
<td>-4.04223069943161e-05</td>
<td>-1.59739033590372</td>
<td>-0.787522052839338</td>
</tr>
<tr>
<td>4</td>
<td>13</td>
<td>-0.000263426853392668</td>
<td>1.99758178983862e-05</td>
<td>-0.944509292501053</td>
<td>0.485462700770483</td>
</tr>
<tr>
<td>5</td>
<td>14</td>
<td>-0.000378046497416255</td>
<td>2.34740130451825e-05</td>
<td>-1.73858632734512</td>
<td>1.35009082193967</td>
</tr>
<tr>
<td>6</td>
<td>15</td>
<td>-0.000646674391910587</td>
<td>-3.70838168829258e-05</td>
<td>-0.959337869213977</td>
<td>-1.02134623746244</td>
</tr>
<tr>
<td>7</td>
<td>16</td>
<td>-0.000322140793892591</td>
<td>-2.30772652374582e-07</td>
<td>-1.06358126806893</td>
<td>-0.0656071719105106</td>
</tr>
<tr>
<td>8</td>
<td>17</td>
<td>0.000116431689160235</td>
<td>-1.04917971054775e-05</td>
<td>0.46542267123334</td>
<td>-0.491093673168217</td>
</tr>
<tr>
<td>9</td>
<td>18</td>
<td>4.29763623128189e-05</td>
<td>-1.09755671884696e-06</td>
<td>0.144642150856474</td>
<td>-0.037695401968076</td>
</tr>
<tr>
<td>10</td>
<td>19</td>
<td>4.10803934318818e-05</td>
<td>4.78439271915337e-06</td>
<td>0.177094367562872</td>
<td>0.0818549889870174</td>
</tr>
<tr>
<td>11</td>
<td>20</td>
<td>1.76587028826167e-05</td>
<td>2.92763675704891e-05</td>
<td>0.0639050539645888</td>
<td>1.59132242966391</td>
</tr>
<tr>
<td>12</td>
<td>21</td>
<td>-0.00022108257125467</td>
<td>3.26849885416974e-05</td>
<td>-0.297899566343352</td>
<td>0.85074801546716</td>
</tr>
</tbody>
</table>
<p>we can also plot</p>
<pre data-role="codeBlock" data-info="R" class="language-r">png<span class="token punctuation">(</span><span class="token string">&apos;beta.png&apos;</span><span class="token punctuation">)</span>
p <span class="token operator">=</span> read.csv<span class="token punctuation">(</span><span class="token string">&quot;beta.csv&quot;</span><span class="token punctuation">)</span>

par<span class="token punctuation">(</span>mfrow <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword keyword-for">for</span><span class="token punctuation">(</span>i <span class="token keyword keyword-in">in</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    names<span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span>
    plot<span class="token punctuation">(</span>p<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>p<span class="token punctuation">[</span><span class="token punctuation">,</span>i<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>ylab <span class="token operator">=</span> names<span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
dev.off<span class="token punctuation">(</span><span class="token punctuation">)</span>
</pre><p><img src="beta.png?0.03204761200628181" alt></p>
<p>the script this part is saved as &apos;parta.r&apos; , the input data it used is &apos;dat.csv&apos; , the out put files are : &quot;beta.csv&quot; and &quot;beta.png&quot;</p>
<h2 class="mume-header" id="part-b">part B</h2>

<p>we add a function to &apos;calculate.r&apos;</p>
<ul>
<li><code>expect(b,v,m)</code><br>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>b</mi><mo stretchy="false">[</mo><mn>1</mn><mo stretchy="false">]</mo><mo>&#x2217;</mo><mi>v</mi><mo>+</mo><mi>b</mi><mo stretchy="false">[</mo><mn>2</mn><mo stretchy="false">]</mo><mo>&#x2217;</mo><mi>m</mi></mrow><annotation encoding="application/x-tex">b[1]*v + b[2] * m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">b</span><span class="mopen">[</span><span class="mord">1</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">&#x2217;</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">b</span><span class="mopen">[</span><span class="mord">2</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">&#x2217;</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">m</span></span></span></span></span></li>
<li><code>change()</code><br>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo><mo>=</mo><mrow><mo fence="true">{</mo><mtable rowspacing="0.3600em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>&#x2212;</mo><mn>1</mn><mo separator="true">,</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mtext>if&#xA0;</mtext><mstyle scriptlevel="0" displaystyle="false"><mi>n</mi></mstyle><mtext>&#xA0;&lt;-0.6</mtext></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>1</mn><mo separator="true">,</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mtext>if&#xA0;</mtext><mstyle scriptlevel="0" displaystyle="false"><mi>n</mi></mstyle><mtext>&#xA0;&gt;&#xA0;0.6</mtext></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>0</mn><mo separator="true">,</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mtext>else</mtext></mstyle></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">f(n) =
\begin{cases}
-1,  &amp; \text{if $n$ &lt;-0.6} \\
1, &amp; \text{if $n$ &gt; 0.6}\\
0, &amp; \text{else}
\end{cases}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:4.32em;vertical-align:-1.9099999999999997em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.3500199999999998em;"><span style="top:-2.19999em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>&#x23A9;</span></span></span><span style="top:-2.19199em;"><span class="pstrut" style="height:3.15em;"></span><span style="height:0.31599999999999984em;width:0.889em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.889em" height="0.31599999999999984em" style="width:0.889em" viewBox="0 0 889 316" preserveAspectRatio="xMinYMin"><path d="M384 0 H504 V316 H384z M384 0 H504 V316 H384z"/></svg></span></span><span style="top:-3.15001em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>&#x23A8;</span></span></span><span style="top:-4.292009999999999em;"><span class="pstrut" style="height:3.15em;"></span><span style="height:0.31599999999999984em;width:0.889em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.889em" height="0.31599999999999984em" style="width:0.889em" viewBox="0 0 889 316" preserveAspectRatio="xMinYMin"><path d="M384 0 H504 V316 H384z M384 0 H504 V316 H384z"/></svg></span></span><span style="top:-4.600019999999999em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>&#x23A7;</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:1.8500199999999998em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.41em;"><span style="top:-4.41em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord">&#x2212;</span><span class="mord">1</span><span class="mpunct">,</span></span></span><span style="top:-2.97em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord">1</span><span class="mpunct">,</span></span></span><span style="top:-1.5300000000000002em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord">0</span><span class="mpunct">,</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:1.9099999999999997em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:1em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.41em;"><span style="top:-4.41em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord text"><span class="mord">if&#xA0;</span><span class="mord mathnormal">n</span><span class="mord">&#xA0;&lt;-0.6</span></span></span></span><span style="top:-2.97em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord text"><span class="mord">if&#xA0;</span><span class="mord mathnormal">n</span><span class="mord">&#xA0;&gt;&#xA0;0.6</span></span></span></span><span style="top:-1.5300000000000002em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord text"><span class="mord">else</span></span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:1.9099999999999997em;"><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></li>
<li><code>weight(re)</code> , <code>apply(re,change)</code></li>
<li><code>fact()</code><br>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>f</mi><mi>a</mi><mi>c</mi><mi>t</mi><mi mathvariant="normal">_</mi><mi>l</mi><mi>o</mi><mi>g</mi><mi>r</mi><mi>e</mi><mi>t</mi><mi>u</mi><mi>r</mi><mi>n</mi><mo>=</mo><mi>l</mi><mi>n</mi><mo stretchy="false">(</mo><mn>1</mn><mo>+</mo><mfrac><mrow><munder><mo>&#x2211;</mo><mi>i</mi></munder><msub><mi>w</mi><mi>i</mi></msub><mo stretchy="false">(</mo><mi>exp</mi><mo>&#x2061;</mo><mo stretchy="false">(</mo><mi>l</mi><mi>o</mi><mi>g</mi><mi>r</mi><mi>e</mi><mi>t</mi><mi>u</mi><mi>r</mi><msub><mi>n</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mo>&#x2212;</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><mrow><munder><mo>&#x2211;</mo><mi>i</mi></munder><mfrac><mn>1</mn><mn>2</mn></mfrac><mi mathvariant="normal">&#x2223;</mi><msub><mi>w</mi><mi>i</mi></msub><mi mathvariant="normal">&#x2223;</mi></mrow></mfrac><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">fact\_logreturn    =ln(1+\frac{\sum_iw_i(\exp(logreturn_i)-1)}{\sum_i\frac{1}{2}|w_i|})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.00444em;vertical-align:-0.31em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal">a</span><span class="mord mathnormal">c</span><span class="mord mathnormal">t</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">re</span><span class="mord mathnormal">t</span><span class="mord mathnormal">u</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">n</span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.5198180000000003em;vertical-align:-1.080108em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4397100000000003em;"><span style="top:-2.2648919999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">&#x2211;</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16195399999999993em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord">&#x2223;</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">&#x2223;</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.6897100000000003em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">&#x2211;</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16195399999999993em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mop">exp</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">re</span><span class="mord mathnormal">t</span><span class="mord mathnormal">u</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">&#x2212;</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:1.080108em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">)</span></span></span></span></span></li>
</ul>
<pre data-role="codeBlock" data-info="R" class="language-r"><span class="token comment"># 1.</span>
<span class="token comment">#construct portfolio</span>
re <span class="token operator">=</span> expect<span class="token punctuation">(</span>beta<span class="token punctuation">,</span>v<span class="token punctuation">,</span>m<span class="token punctuation">)</span>
w <span class="token operator">=</span> weight<span class="token punctuation">(</span>re<span class="token punctuation">)</span>

<span class="token comment"># 2.</span>
<span class="token comment">#get the portfolio return at each time step t.</span>
rf <span class="token operator">=</span> fact<span class="token punctuation">(</span>w<span class="token punctuation">,</span>mat<span class="token punctuation">(</span>logr<span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><p>the daily logreturn is saved in &apos;dailyreturn.csv&apos; , yearly result saved in &apos;return.csv&apos;</p>
<table>
<thead>
<tr>
<th></th>
<th>tlist</th>
<th>logr_year</th>
<th>sd_year</th>
<th>sharp</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>10</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>2</td>
<td>11</td>
<td>-0.166755926528585</td>
<td>0.00471778231250174</td>
<td>-0.158503376027637</td>
</tr>
<tr>
<td>3</td>
<td>12</td>
<td>-0.0455564234791016</td>
<td>0.00425416779874613</td>
<td>-0.0484554612213748</td>
</tr>
<tr>
<td>4</td>
<td>13</td>
<td>-0.00619289657519553</td>
<td>0.00561371661011681</td>
<td>-0.00510727909315688</td>
</tr>
<tr>
<td>5</td>
<td>14</td>
<td>0.0488126400990426</td>
<td>0.00394187299454885</td>
<td>0.0555296335215965</td>
</tr>
<tr>
<td>6</td>
<td>15</td>
<td>0.252851014188804</td>
<td>0.0102781907104545</td>
<td>0.110814107703167</td>
</tr>
<tr>
<td>7</td>
<td>16</td>
<td>0.0476927788633998</td>
<td>0.00493277799642757</td>
<td>0.0435519979569541</td>
</tr>
<tr>
<td>8</td>
<td>17</td>
<td>-0.0925000505466106</td>
<td>0.00510015082349255</td>
<td>-0.0816969750060785</td>
</tr>
<tr>
<td>9</td>
<td>18</td>
<td>0.148305859081358</td>
<td>0.00511933457318767</td>
<td>0.131084856062533</td>
</tr>
<tr>
<td>10</td>
<td>19</td>
<td>0.00104325024132195</td>
<td>0.00472917531382879</td>
<td>0.000993688137891325</td>
</tr>
<tr>
<td>11</td>
<td>20</td>
<td>0.000455372486962358</td>
<td>0.00575956359550823</td>
<td>0.000357754360484334</td>
</tr>
<tr>
<td>12</td>
<td>21</td>
<td>-0.130066218388905</td>
<td>0.0106574661651426</td>
<td>-0.162723129336079</td>
</tr>
</tbody>
</table>
<p>from here we know that the best year is 2015 , and the worst is 2011 .the the annual return (annually logreturn) volatility of the portfolio is <code>sd(read.csv(&apos;return.csv&apos;)[,3])</code> : <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.115089054444508</mn></mrow><annotation encoding="application/x-tex">0.115089054444508</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0.115089054444508</span></span></span></span></p>
<p>we also use function <code>pnl()</code> to plot the total PnL:</p>
<p><img src="pnl.png?0.1899202924488843" alt></p>
<h2 class="mume-header" id="part-c">part C</h2>

<p>when considering cost model , we simply minus 0.001 from the everyday-log-return and get the part-B-PnL considering cost (trade every day,buy cost 0.0005,sell cost 0.0005, 0.0005 &lt;&lt; 1 ,so simply minus 0.001)<code>pnl(dailyreturn-0.0005,&quot;pnlcost.png&quot;)</code></p>
<p><img src="pnlcost.png?0.31549685096003777" alt></p>
<p>then we considering hold some position longer then one day , which means the daily log return cost is less than 0.001 (if we hold A today , and tomorrow , it doesn&apos;t make cost)</p>
<p>so we change the daily logreturn fomula , from <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mi>n</mi><mo stretchy="false">(</mo><mn>1</mn><mo>+</mo><mfrac><mrow><msub><mo>&#x2211;</mo><mi>i</mi></msub><msub><mi>w</mi><mi>i</mi></msub><mo stretchy="false">(</mo><mi>exp</mi><mo>&#x2061;</mo><mo stretchy="false">(</mo><mi>l</mi><mi>o</mi><mi>g</mi><mi>r</mi><mi>e</mi><mi>t</mi><mi>u</mi><mi>r</mi><msub><mi>n</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mo>&#x2212;</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><mrow><msub><mo>&#x2211;</mo><mi>i</mi></msub><mfrac><mn>1</mn><mn>2</mn></mfrac><mi mathvariant="normal">&#x2223;</mi><msub><mi>w</mi><mi>i</mi></msub><mi mathvariant="normal">&#x2223;</mi></mrow></mfrac><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">ln(1+\frac{\sum_iw_i(\exp(logreturn_i)-1)}{\sum_i\frac{1}{2}|w_i|})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">n</span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.7018269999999998em;vertical-align:-0.64182em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.060007em;"><span style="top:-2.59898em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mop mtight"><span class="mop op-symbol small-op mtight" style="position:relative;top:-0.0000050000000000050004em;">&#x2211;</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1496471428571428em;"><span style="top:-2.1785614285714283em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.32143857142857146em;"><span></span></span></span></span></span></span><span class="mspace mtight" style="margin-right:0.19516666666666668em;"></span><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8443142857142858em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.2255000000000003em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span><span class="mord mtight">&#x2223;</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mord mtight">&#x2223;</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.5350070000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mop mtight"><span class="mop op-symbol small-op mtight" style="position:relative;top:-0.0000050000000000050004em;">&#x2211;</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1496471428571428em;"><span style="top:-2.1785614285714283em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.32143857142857146em;"><span></span></span></span></span></span></span><span class="mspace mtight" style="margin-right:0.19516666666666668em;"></span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mopen mtight">(</span><span class="mop mtight"><span class="mtight">e</span><span class="mtight">x</span><span class="mtight">p</span></span><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span><span class="mord mathnormal mtight">re</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mclose mtight">)</span><span class="mbin mtight">&#x2212;</span><span class="mord mtight">1</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.64182em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">)</span></span></span></span> to:<br>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>f</mi><mi>a</mi><mi>c</mi><mi>t</mi><mi mathvariant="normal">_</mi><mi>l</mi><mi>o</mi><mi>g</mi><mi>r</mi><mi>e</mi><mi>t</mi><mi>u</mi><mi>r</mi><mi>n</mi><mo>=</mo><mi>l</mi><mi>n</mi><mo stretchy="false">(</mo><mn>1</mn><mo>+</mo><mfrac><mrow><munder><mo>&#x2211;</mo><mi>i</mi></munder><msub><mi>w</mi><mi>i</mi></msub><mo stretchy="false">(</mo><mi>exp</mi><mo>&#x2061;</mo><mo stretchy="false">(</mo><mi>l</mi><mi>o</mi><mi>g</mi><mi>r</mi><mi>e</mi><mi>t</mi><mi>u</mi><mi>r</mi><msub><mi>n</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mo>&#x2212;</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><mrow><munder><mo>&#x2211;</mo><mi>i</mi></munder><mfrac><mn>1</mn><mn>2</mn></mfrac><mi mathvariant="normal">&#x2223;</mi><msub><mi>w</mi><mi>i</mi></msub><mi mathvariant="normal">&#x2223;</mi></mrow></mfrac><mo>&#x2212;</mo><mfrac><mrow><munder><mo>&#x2211;</mo><mi>i</mi></munder><mi mathvariant="normal">&#x2223;</mi><mi>&#x3B4;</mi><msub><mi>w</mi><mi>i</mi></msub><mi mathvariant="normal">&#x2223;</mi><mo>&#x2217;</mo><mn>0.0005</mn></mrow><mrow><munder><mo>&#x2211;</mo><mi>i</mi></munder><mfrac><mn>1</mn><mn>2</mn></mfrac><mi mathvariant="normal">&#x2223;</mi><msub><mi>w</mi><mi>i</mi></msub><mi mathvariant="normal">&#x2223;</mi></mrow></mfrac><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">fact\_logreturn    =ln(1+\frac{\sum_iw_i(\exp(logreturn_i)-1)}{\sum_i\frac{1}{2}|w_i|}-\frac{\sum_i|&#x3B4; w_i|*0.0005}{\sum_i\frac{1}{2}|w_i|})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.00444em;vertical-align:-0.31em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal">a</span><span class="mord mathnormal">c</span><span class="mord mathnormal">t</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">re</span><span class="mord mathnormal">t</span><span class="mord mathnormal">u</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">n</span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.5198180000000003em;vertical-align:-1.080108em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4397100000000003em;"><span style="top:-2.2648919999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">&#x2211;</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16195399999999993em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord">&#x2223;</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">&#x2223;</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.6897100000000003em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">&#x2211;</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16195399999999993em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mop">exp</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">re</span><span class="mord mathnormal">t</span><span class="mord mathnormal">u</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">&#x2212;</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:1.080108em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">&#x2212;</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.5198180000000003em;vertical-align:-1.080108em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4397100000000003em;"><span style="top:-2.2648919999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">&#x2211;</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16195399999999993em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord">&#x2223;</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">&#x2223;</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.6897100000000003em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">&#x2211;</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16195399999999993em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">&#x2223;</span><span class="mord mathnormal" style="margin-right:0.03785em;">&#x3B4;</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">&#x2223;</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">&#x2217;</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">0.0005</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:1.080108em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">)</span></span></span></span></span></p>
<p>we add function <code>factc()</code> to &apos;calculate.r&apos; , and use it instead of fact , to get the modified resullt of part B. this is in &apos;partbc.r&apos;</p>
<p>and the PnL is :</p>
<p><img src="pnlcostc.png?0.8921429534560739" alt></p>
<p>this picture beeing much better than above is because this item <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>&#x2212;</mo><mfrac><mrow><msub><mo>&#x2211;</mo><mi>i</mi></msub><mi mathvariant="normal">&#x2223;</mi><mi>&#x3B4;</mi><msub><mi>w</mi><mi>i</mi></msub><mi mathvariant="normal">&#x2223;</mi><mo>&#x2217;</mo><mn>0.0005</mn></mrow><mrow><msub><mo>&#x2211;</mo><mi>i</mi></msub><mfrac><mn>1</mn><mn>2</mn></mfrac><mi mathvariant="normal">&#x2223;</mi><msub><mi>w</mi><mi>i</mi></msub><mi mathvariant="normal">&#x2223;</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">-\frac{\sum_i|&#x3B4; w_i|*0.0005}{\sum_i\frac{1}{2}|w_i|}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.7018269999999998em;vertical-align:-0.64182em;"></span><span class="mord">&#x2212;</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.060007em;"><span style="top:-2.59898em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mop mtight"><span class="mop op-symbol small-op mtight" style="position:relative;top:-0.0000050000000000050004em;">&#x2211;</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1496471428571428em;"><span style="top:-2.1785614285714283em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.32143857142857146em;"><span></span></span></span></span></span></span><span class="mspace mtight" style="margin-right:0.19516666666666668em;"></span><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8443142857142858em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.2255000000000003em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span><span class="mord mtight">&#x2223;</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mord mtight">&#x2223;</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.5350070000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mop mtight"><span class="mop op-symbol small-op mtight" style="position:relative;top:-0.0000050000000000050004em;">&#x2211;</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1496471428571428em;"><span style="top:-2.1785614285714283em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.32143857142857146em;"><span></span></span></span></span></span></span><span class="mspace mtight" style="margin-right:0.19516666666666668em;"></span><span class="mord mtight">&#x2223;</span><span class="mord mathnormal mtight" style="margin-right:0.03785em;">&#x3B4;</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:-0.02691em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mord mtight">&#x2223;</span><span class="mbin mtight">&#x2217;</span><span class="mord mtight">0.0005</span></span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.64182em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span> take the place of minusing 0.001 directly.</p>
<p>to if <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mo>&#x2211;</mo><mi>i</mi></msub><mi mathvariant="normal">&#x2223;</mi><mi>&#x3B4;</mi><msub><mi>w</mi><mi>i</mi></msub><mi mathvariant="normal">&#x2223;</mi></mrow><annotation encoding="application/x-tex">\sum_i|&#x3B4; w_i|</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0497100000000001em;vertical-align:-0.29971000000000003em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">&#x2211;</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16195399999999993em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">&#x2223;</span><span class="mord mathnormal" style="margin-right:0.03785em;">&#x3B4;</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">&#x2223;</span></span></span></span> get less , the PnL will be better , so we import a hurdle to modify the expcted return :</p>
<p>after import hurdle , we make the decision that if we long stock&#x1D62; today and want to long it tomorrow , we would holde it , instead of selling and buying again , to save the trading cost.</p>
<p>we choose &#x3B3; from {1.1,1.2,...,1.9} while <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mo>=</mo><mi>&#x3B3;</mi><mo>&#x2217;</mo><mi>&#x3C3;</mi></mrow><annotation encoding="application/x-tex">h = \gamma*\sigma</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal">h</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.6597200000000001em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.05556em;">&#x3B3;</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">&#x2217;</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">&#x3C3;</span></span></span></span> and here is the 9 PnLs:</p>
<p><img src="pnl9.png?0.9414381113116492" alt></p>
<p>the first 2 photo in partC means <code>factc()</code> works well , but the 9 PnLs means that different hurdles made little differences on PnL , so I guess the function <code>weightc()</code> may have something wrong , but i didn&apos;t find it .</p>
<h2 class="mume-header" id="part-d">part D</h2>

<h3 class="mume-header" id="a-contribution-to-the-project">a) contribution to the project</h3>

<p>the outline of the whole project is desigined by me , at the wery begining , i write an Abstract in Chinese containing all the math fomula and then we translate it together to the form we upload .</p>
<p>before the coding process , to make the cooperation easier , i wrote a detailed <a href="http://task.md">task.md</a> file to illustrate what should every body do , as well as the form of intermediate-step-file . i thought that this could help people start the later part of the whole project easily , after all , without data , they can know the data form from that file . you can refer it at the bottom of this file.</p>
<p>during the coding process , i found that the early part and the later part both didn&apos;t meet the requirement of our every-onr-tesk , none of them can offer me a standard data file or the script . they didn&apos;t give me the monthly industry return , the factors they didn&apos;t modified successfully , there wasn&apos;t r.csv or e.csv either . so i need to adjust the plan near the ddl. and i have to pick up all the troubles and nearly do the whole works again.</p>
<p>for the strategy part , i communicate with them and tell them which strategy may be useful.</p>
<p>during the report writting and ppt making part , i write our regrassion part . How we get the &#x3B1; , &#x3B2; ,and why.</p>
<h3 class="mume-header" id="b-difficulty">b) difficulty</h3>

<p>i think coding and debug is the most difficult part for me , especially when there must be some cooperation . coding alone is really different from coding with each other , though i&apos;ve tried a lot to make the cooperation being more smooth , it&apos;s still bother me a lot . even cooperation with myself from different time makes a lot trouble.</p>
<p>before coding line by line , i thought that the difficult part is drawing the outline , dividing the whole project into specific tesk , writting the math behind the model , even writting the pseudocode . however , infact , the time transforming the pseudocode into real code is the same as summing all other together .</p>
<p>the 3 assignment contain the same part . in principle , we can use the earlier one to solve the later one . however , because the lack of experience , i write the first one by pyhton , the second one R , when i want to use the second one to do the last one , i find i just write all the code in a single file , a single function , that is because i don&apos;t know the function <code>source()</code> in R . To make my final work more readable , i have to write all the work again.</p>
<p>reading my own early work can bother me that much , no matter how difficult it is to read the others. during the cooperation process , i find that reality is really different from what i thought.</p>
<p>at last , after this introspection , i find all my difficulty is technologically instead of theoretically . i know after 1~2 years training i can overcome all this technological problem , but i also strongly wander if there is a shortcut.</p>
<h3 class="mume-header" id="c-most-interesting">c) most interesting</h3>

<p>i think the cost are the most interesting part , especially this photo:</p>
<p><img src="p.png?0.551987122828679" alt></p>
<p>the qualitative analysis is obvious , but the quantitative behand it is mysterious , mabe people have some empirical formula , but we still don&apos;t know the dynamic principle details . i think this part is interesting .</p>
<h3 class="mume-header" id="d">d)</h3>

<p>i think it&apos;s not difficult at all for me to understand the topics . the logic and math behind them is intuitionistic.</p>
<hr>
<p>next i will offer some refference:</p>
<ul>
<li><a href="http://tesk.md">tesk.md</a></li>
<li>functions : calculate.r</li>
<li>script for each part : parta.r partb.r partbc.r partc.r</li>
</ul>
<hr>
<h1 class="mume-header" id="teskmd"><a href="http://tesk.md">tesk.md</a> :</h1>

<h1 class="mume-header" id="specific-task-for-every-one">specific task for every one</h1>

<h2 class="mume-header" id="liyi-and-zhutianhang21-in-the-abstract">liyi and zhutianhang(2.1 in the abstract)</h2>

<p>you two need to upload 4 files intotal , two of them will influence others&apos; work , the other two do nothing with other members , but necessary for our final report.</p>
<h3 class="mume-header" id="returncsv">return.csv</h3>

<p>in this csv , we need summarized industry return , it&apos;s not the original price of every socks, but the logreturn every day you calculated for each industry:</p>
<table>
<thead>
<tr>
<th>label</th>
<th>industrycode</th>
<th>20070103</th>
<th>20070104</th>
<th>...</th>
<th>20210528</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>101020</td>
<td>0.01</td>
<td>-0.01</td>
<td>...</td>
<td>0</td>
</tr>
<tr>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>0</td>
<td></td>
</tr>
<tr>
<td>J</td>
<td>601020</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>that is a ((J+1) <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>&#xD7;</mo></mrow><annotation encoding="application/x-tex">\times</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord">&#xD7;</span></span></span></span> (T+1))csv , J means there are J industries , T means there are T trading days .</p>
<h2 class="mume-header" id="factorcsv">factor.csv</h2>

<p>in this file there should be  I independent factors:</p>
<table>
<thead>
<tr>
<th>label</th>
<th>factornames</th>
<th>20070103</th>
<th>20070104</th>
<th>...</th>
<th>20210528</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>risk-free-rate</td>
<td>0.01</td>
<td>-0.01</td>
<td>...</td>
<td>0</td>
</tr>
<tr>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td></td>
<td></td>
</tr>
<tr>
<td>I</td>
<td>No.I factor&apos;s name</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>that is a ((I+1) <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>&#xD7;</mo></mrow><annotation encoding="application/x-tex">\times</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord">&#xD7;</span></span></span></span> (T+1))csv , I means there are I factors , T means there are T trading days .</p>
<h3 class="mume-header" id="other-files">other files</h3>

<p>beside these two files you need to offer the original data you used in one file (you can name it 1.csv or any thing you want.) and the code you got the upside 2 file in another file(mabe called <a href="http://1.py">1.py</a> or 1.R), this 2 file don&apos;t influence other&apos;s work directly so the format is not necessary to determined.</p>
<h2 class="mume-header" id="liyusu22-in-the-abstract">liyusu(2.2 in the abstract)</h2>

<p>i need to up load 3 files in total , first 2 is used in other part ,  the 3rd is code.</p>
<h3 class="mume-header" id="alphacsv">alpha.csv</h3>

<p>the format is the same as price.csv . the only thing different is the value change from logreturn to alpha[j,t] , but because of our definetion , we dont have R(t) where t <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>&#x2208;</mo></mrow><annotation encoding="application/x-tex">\in</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&#x2208;</span></span></span></span> [T,T+<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">&#x394;</mi></mrow><annotation encoding="application/x-tex">\Delta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord">&#x394;</span></span></span></span>t] , so the max of the time label of alpha is T-<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">&#x394;</mi></mrow><annotation encoding="application/x-tex">\Delta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord">&#x394;</span></span></span></span>t</p>
<h3 class="mume-header" id="betacsv">beta.csv</h3>

<table>
<thead>
<tr>
<th>label</th>
<th>factornames</th>
<th>20070103</th>
<th>20070104</th>
<th>...</th>
<th>20210528 -<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">&#x394;</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">\Delta t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord">&#x394;</span><span class="mord mathnormal">t</span></span></span></span></th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>&#x3B2;</mi><mrow><mn>1</mn><mo separator="true">,</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">\beta_{1,1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.980548em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05278em;">&#x3B2;</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:-0.05278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mpunct mtight">,</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span></td>
<td>0.01</td>
<td>-0.01</td>
<td>...</td>
<td>0</td>
</tr>
<tr>
<td>2</td>
<td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>&#x3B2;</mi><mrow><mn>1</mn><mo separator="true">,</mo><mn>2</mn></mrow></msub></mrow><annotation encoding="application/x-tex">\beta_{1,2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.980548em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05278em;">&#x3B2;</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:-0.05278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mpunct mtight">,</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span></td>
<td>0.01</td>
<td>-0.01</td>
<td>...</td>
<td>0</td>
</tr>
<tr>
<td>...</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>(i-1)*j+j</td>
<td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>&#x3B2;</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\beta_{i,j}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.980548em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05278em;">&#x3B2;</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.05278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>...</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>I * J</td>
<td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>&#x3B2;</mi><mrow><mi>I</mi><mo separator="true">,</mo><mi>J</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\beta_{I,J}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.980548em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05278em;">&#x3B2;</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.328331em;"><span style="top:-2.5500000000000003em;margin-left:-0.05278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07847em;">I</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right:0.09618em;">J</span></span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>here alpha and beta is little bit different from the abstract , each column is what we want in abstract . and the column &quot;t1&quot; will have the same value as _t1 _ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">&#x394;</mi></mrow><annotation encoding="application/x-tex">\Delta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord">&#x394;</span></span></span></span>t.csv in the abstract.</p>
<h3 class="mume-header" id="regrassionr">regrassion.R</h3>

<div class="code-chunk" data-id="code-chunk-id-0" data-cmd="windows"><div class="input-div"><pre data-role="codeBlock" data-info="windows cmd" class="language-windows"><code>&gt;ls
price.csv	return.csv
&gt;Rscript regrassion.R
&gt;ls
price.csv	return.cs	alpha.csv	beta.csv
</code></pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><h2 class="mume-header" id="all-of-us23-in-the-abstract">all of us(2.3 in the abstract)</h2>

<h3 class="mume-header" id="portr">port.R</h3>

<p>the input of port.R is a time ,for example &apos;20210303&apos;</p>
<pre data-role="codeBlock" data-info="cmd" class="language-cmd"><code>&gt;ls
alpha.csv	beta.csv
&gt;Rscript port.R 20210303
&gt;ls
alpha.csv	beta.csv	weight.csv
</code></pre><p>weight.csv:</p>
<table>
<thead>
<tr>
<th>label</th>
<th>industry</th>
<th>20210303</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>101020</td>
<td>0.02</td>
</tr>
<tr>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr>
<td>j</td>
<td>industry<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mrow></mrow><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.597772em;vertical-align:-0.286108em;"></span><span class="mord"><span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span></td>
<td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>w</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">w_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span></td>
</tr>
<tr>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr>
<td>J</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h2 class="mume-header" id="xuyuxin-and-xiaoyumeng24">xuyuxin and xiaoyumeng(2.4)</h2>

<p>you need to upload 2 files r.csv and e.csv:<br>
r.csv:</p>
<table>
<thead>
<tr>
<th>name</th>
<th>t1</th>
<th>...</th>
<th>t10</th>
</tr>
</thead>
<tbody>
<tr>
<td>liyi</td>
<td>3.7</td>
<td>...</td>
<td>4.8</td>
</tr>
<tr>
<td>...</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>in which t<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mrow></mrow><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.46166399999999996em;vertical-align:-0.15em;"></span><span class="mord"><span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> is a random time belongs to our datset 3.7 is the total log return calculate from liyi&apos;s w<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mrow></mrow><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.46166399999999996em;vertical-align:-0.15em;"></span><span class="mord"><span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> using time input t<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mrow></mrow><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.46166399999999996em;vertical-align:-0.15em;"></span><span class="mord"><span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> .<br>
the format of e.csv is the same as r.csv.</p>
<p>only different is taht the value is residuals instead of return.<br>
you&apos;d better also upload your code and conclussion.</p>
<hr>
<h1 class="mume-header" id="calculater">calculate.r</h1>

<pre data-role="codeBlock" data-info="r" class="language-r"><span class="token comment">#dat = read.csv(&apos;test18.csv&apos;)</span>
<span class="token comment">#dat = dat[,2:dim(dat)[2]]</span>

logreturn <span class="token operator">=</span> <span class="token keyword keyword-function">function</span><span class="token punctuation">(</span>dat<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">#dat = read.csv(&apos;test18.csv&apos;)</span>
    <span class="token comment">#dat = dat[,2:dim(dat)[2]]</span>
    i <span class="token operator">=</span> dim<span class="token punctuation">(</span>dat<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    j <span class="token operator">=</span> dim<span class="token punctuation">(</span>dat<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
    mat <span class="token operator">=</span> as.matrix<span class="token punctuation">(</span>dat<span class="token punctuation">[</span><span class="token number">4</span><span class="token operator">:</span>i<span class="token punctuation">,</span><span class="token number">3</span><span class="token operator">:</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span>
    mat <span class="token operator">=</span> log<span class="token punctuation">(</span>mat<span class="token punctuation">)</span>
    mat1 <span class="token operator">=</span> mat<span class="token punctuation">[</span><span class="token number">2</span><span class="token operator">:</span><span class="token punctuation">(</span>i<span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span> <span class="token operator">-</span> mat<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token punctuation">(</span>i<span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span>
    logr <span class="token operator">=</span> dat 
    logr<span class="token punctuation">[</span><span class="token number">5</span><span class="token operator">:</span>i<span class="token punctuation">,</span><span class="token number">3</span><span class="token operator">:</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> mat1
    logr<span class="token punctuation">[</span>is.na<span class="token punctuation">(</span>logr<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>
    return <span class="token punctuation">(</span>logr<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

app <span class="token operator">=</span> <span class="token keyword keyword-function">function</span><span class="token punctuation">(</span>dat<span class="token punctuation">,</span>x<span class="token punctuation">,</span>f<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">#dat = read.csv(&apos;logr18.csv&apos;)</span>
    <span class="token comment">#dat = dat[,2:dim(dat)[2]]</span>
    i <span class="token operator">=</span> dim<span class="token punctuation">(</span>dat<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">24</span>
    j <span class="token operator">=</span> dim<span class="token punctuation">(</span>dat<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">2</span>
    tem <span class="token operator">=</span> array<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>dim <span class="token operator">=</span> c<span class="token punctuation">(</span>x<span class="token punctuation">,</span>i<span class="token punctuation">,</span>j<span class="token punctuation">)</span><span class="token punctuation">)</span>
    mat <span class="token operator">=</span> as.matrix<span class="token punctuation">(</span>dat<span class="token punctuation">[</span><span class="token number">4</span><span class="token operator">:</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token operator">:</span>j<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>i1 <span class="token keyword keyword-in">in</span> <span class="token number">1</span><span class="token operator">:</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       tem<span class="token punctuation">[</span><span class="token punctuation">,</span>i1<span class="token punctuation">,</span><span class="token punctuation">]</span> <span class="token operator">=</span> mat<span class="token punctuation">[</span><span class="token punctuation">(</span>i1<span class="token operator">-</span>x<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">:</span>i1<span class="token operator">+</span><span class="token number">21</span><span class="token punctuation">,</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
    mat1 <span class="token operator">=</span> apply<span class="token punctuation">(</span>tem <span class="token punctuation">,</span> c<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">,</span> f<span class="token punctuation">)</span>
    dat<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span>i <span class="token operator">+</span> <span class="token number">24</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token operator">:</span>j <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> mat1
    dat1 <span class="token operator">=</span> dat<span class="token punctuation">[</span>c<span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">25</span><span class="token operator">:</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>c<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token operator">:</span><span class="token punctuation">(</span>j<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    return <span class="token punctuation">(</span>dat1<span class="token punctuation">)</span>
<span class="token punctuation">}</span>


mat <span class="token operator">=</span> <span class="token keyword keyword-function">function</span><span class="token punctuation">(</span>dat<span class="token punctuation">)</span><span class="token punctuation">{</span>
    i <span class="token operator">=</span> dim<span class="token punctuation">(</span>dat<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    j <span class="token operator">=</span> dim<span class="token punctuation">(</span>dat<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
    mat1 <span class="token operator">=</span> as.matrix<span class="token punctuation">(</span>dat<span class="token punctuation">[</span><span class="token number">4</span><span class="token operator">:</span>i<span class="token punctuation">,</span><span class="token number">3</span><span class="token operator">:</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span>
    return<span class="token punctuation">(</span>mat1<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

mata <span class="token operator">=</span> <span class="token keyword keyword-function">function</span><span class="token punctuation">(</span>dat<span class="token punctuation">)</span><span class="token punctuation">{</span>
    i <span class="token operator">=</span> dim<span class="token punctuation">(</span>dat<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    j <span class="token operator">=</span> dim<span class="token punctuation">(</span>dat<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
    mat1 <span class="token operator">=</span> as.matrix<span class="token punctuation">(</span>dat<span class="token punctuation">[</span><span class="token number">4</span><span class="token operator">:</span>i<span class="token punctuation">,</span><span class="token number">2</span><span class="token operator">:</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span>
    return<span class="token punctuation">(</span>mat1<span class="token punctuation">)</span>
<span class="token punctuation">}</span>



<span class="token comment">#minus()</span>
minus1 <span class="token operator">=</span> <span class="token keyword keyword-function">function</span><span class="token punctuation">(</span>logr<span class="token punctuation">)</span><span class="token punctuation">{</span>
    tem <span class="token operator">=</span> t<span class="token punctuation">(</span>logr<span class="token punctuation">)</span>
    tem <span class="token operator">=</span> as.data.frame<span class="token punctuation">(</span>tem<span class="token punctuation">[</span><span class="token number">3</span><span class="token operator">:</span>dim<span class="token punctuation">(</span>tem<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    names<span class="token punctuation">(</span>tem<span class="token punctuation">)</span> <span class="token operator">=</span> t<span class="token punctuation">(</span>logr<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">]</span>
    tem<span class="token operator">$</span>indu <span class="token operator">=</span> as.numeric<span class="token punctuation">(</span>tem<span class="token operator">$</span>Gics<span class="token punctuation">)</span> <span class="token percent-operator operator">%/%</span> <span class="token number">100</span>
    gda <span class="token operator">&lt;-</span> group_by<span class="token punctuation">(</span>tem<span class="token punctuation">,</span> indu<span class="token punctuation">)</span>
    industry <span class="token operator">=</span> as.data.frame<span class="token punctuation">(</span>summarise<span class="token punctuation">(</span>gda<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-for">for</span><span class="token punctuation">(</span>i <span class="token keyword keyword-in">in</span> <span class="token number">1</span><span class="token operator">:</span>dim<span class="token punctuation">(</span>industry<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        indi <span class="token operator">=</span> <span class="token punctuation">(</span>tem<span class="token operator">$</span>indu <span class="token operator">==</span> industry<span class="token punctuation">[</span>i<span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        industryi <span class="token operator">=</span> as.matrix<span class="token punctuation">(</span>tem<span class="token punctuation">[</span>indi<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token operator">:</span>dim<span class="token punctuation">(</span>tem<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        industryi <span class="token operator">=</span> apply<span class="token punctuation">(</span>industryi<span class="token punctuation">,</span>c<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>as.numeric<span class="token punctuation">)</span>
        industryi <span class="token operator">=</span> industryi <span class="token operator">-</span> apply<span class="token punctuation">(</span>industryi<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span>mean<span class="token punctuation">)</span>
        tem<span class="token punctuation">[</span>indi<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token operator">:</span>dim<span class="token punctuation">(</span>tem<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> industryi
    <span class="token punctuation">}</span>
    result <span class="token operator">=</span> as.data.frame<span class="token punctuation">(</span>t<span class="token punctuation">(</span>tem<span class="token punctuation">)</span><span class="token punctuation">)</span>
    result <span class="token operator">=</span> apply<span class="token punctuation">(</span>result<span class="token punctuation">,</span>c<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>as.numeric<span class="token punctuation">)</span>
    re <span class="token operator">=</span> logr
    re<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token operator">:</span>dim<span class="token punctuation">(</span>re<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> result<span class="token punctuation">[</span><span class="token number">2</span><span class="token operator">:</span>dim<span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">]</span>
    return<span class="token punctuation">(</span>re<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

minus <span class="token operator">=</span> <span class="token keyword keyword-function">function</span><span class="token punctuation">(</span>logr<span class="token punctuation">)</span><span class="token punctuation">{</span>
    tem <span class="token operator">=</span> t<span class="token punctuation">(</span>logr<span class="token punctuation">)</span>
    tem <span class="token operator">=</span> as.data.frame<span class="token punctuation">(</span>tem<span class="token punctuation">[</span><span class="token number">3</span><span class="token operator">:</span>dim<span class="token punctuation">(</span>tem<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    names<span class="token punctuation">(</span>tem<span class="token punctuation">)</span> <span class="token operator">=</span> t<span class="token punctuation">(</span>logr<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">]</span>
    tem<span class="token operator">$</span>indu <span class="token operator">=</span> as.numeric<span class="token punctuation">(</span>tem<span class="token operator">$</span>Gics<span class="token punctuation">)</span> <span class="token percent-operator operator">%/%</span> <span class="token number">100</span>
    gda <span class="token operator">&lt;-</span> group_by<span class="token punctuation">(</span>tem<span class="token punctuation">,</span> indu<span class="token punctuation">)</span>
    industry <span class="token operator">=</span> as.data.frame<span class="token punctuation">(</span>summarise<span class="token punctuation">(</span>gda<span class="token punctuation">)</span><span class="token punctuation">)</span>
    m <span class="token operator">=</span> mat<span class="token punctuation">(</span>logr<span class="token punctuation">)</span>
    row <span class="token operator">=</span> as.matrix<span class="token punctuation">(</span>logr<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token operator">:</span>dim<span class="token punctuation">(</span>logr<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>i <span class="token keyword keyword-in">in</span> <span class="token number">1</span><span class="token operator">:</span>dim<span class="token punctuation">(</span>industry<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        indi <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>row<span class="token percent-operator operator">%/%</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">==</span> industry<span class="token punctuation">[</span>i<span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        industryi <span class="token operator">=</span> as.matrix<span class="token punctuation">(</span>m<span class="token punctuation">[</span><span class="token punctuation">,</span>indi<span class="token punctuation">]</span><span class="token punctuation">)</span>
        industryi <span class="token operator">=</span> industryi <span class="token operator">-</span> apply<span class="token punctuation">(</span>industryi<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>mean<span class="token punctuation">)</span>
        m<span class="token punctuation">[</span><span class="token punctuation">,</span>indi<span class="token punctuation">]</span> <span class="token operator">=</span> industryi
    <span class="token punctuation">}</span>
    i <span class="token operator">=</span> dim<span class="token punctuation">(</span>logr<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    j <span class="token operator">=</span> dim<span class="token punctuation">(</span>logr<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
    logr<span class="token punctuation">[</span><span class="token number">4</span><span class="token operator">:</span>i<span class="token punctuation">,</span><span class="token number">3</span><span class="token operator">:</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> m
    return<span class="token punctuation">(</span>logr<span class="token punctuation">)</span>
<span class="token punctuation">}</span>



ran <span class="token operator">=</span> <span class="token keyword keyword-function">function</span><span class="token punctuation">(</span>mat<span class="token punctuation">)</span><span class="token punctuation">{</span>
    k <span class="token operator">=</span> t<span class="token punctuation">(</span>apply<span class="token punctuation">(</span>mat<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> rank<span class="token punctuation">)</span><span class="token punctuation">)</span>
    n <span class="token operator">=</span> dim<span class="token punctuation">(</span>mat<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
    v <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">*</span>k<span class="token operator">-</span>n<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span>n<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
    return<span class="token punctuation">(</span>v<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

regr <span class="token operator">=</span> <span class="token keyword keyword-function">function</span><span class="token punctuation">(</span>mat0<span class="token punctuation">,</span>mat1<span class="token punctuation">,</span>mat2<span class="token punctuation">)</span><span class="token punctuation">{</span>
    v <span class="token operator">=</span> mat1
    m <span class="token operator">=</span> mat2
    lr <span class="token operator">=</span> mat0
    t <span class="token operator">=</span> dim<span class="token punctuation">(</span>mat0<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    k <span class="token operator">=</span> dim<span class="token punctuation">(</span>mat0<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
    beta <span class="token operator">=</span> array<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>dim <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>t<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>i <span class="token keyword keyword-in">in</span> <span class="token number">2</span><span class="token operator">:</span>t<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        x <span class="token operator">=</span> cbind<span class="token punctuation">(</span>v<span class="token punctuation">[</span>i<span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>m<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
        y <span class="token operator">=</span> as.matrix<span class="token punctuation">(</span>lr<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        a <span class="token operator">=</span> t<span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token percent-operator operator">%*%</span> x
        <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>det<span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            x <span class="token operator">=</span> v<span class="token punctuation">[</span>i<span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token operator">+</span>m<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
            a <span class="token operator">=</span> sum<span class="token punctuation">(</span>x<span class="token operator">*</span>x<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        b <span class="token operator">=</span> t<span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token percent-operator operator">%*%</span> y
        
        beta<span class="token punctuation">[</span><span class="token punctuation">,</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> solve<span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    return<span class="token punctuation">(</span>beta<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

t_s <span class="token operator">=</span> <span class="token keyword keyword-function">function</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">{</span>
    T <span class="token operator">=</span> length<span class="token punctuation">(</span>a<span class="token punctuation">)</span>
    t_s <span class="token operator">=</span> sqrt<span class="token punctuation">(</span>T<span class="token punctuation">)</span> <span class="token operator">*</span> mean<span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">/</span> sd<span class="token punctuation">(</span>a<span class="token punctuation">)</span>
    return<span class="token punctuation">(</span>t_s<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

expect <span class="token operator">=</span> <span class="token keyword keyword-function">function</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span>v<span class="token punctuation">,</span>m<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    return<span class="token punctuation">(</span>b<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> v <span class="token operator">+</span> b<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">*</span> m<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

change <span class="token operator">=</span> <span class="token keyword keyword-function">function</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>n <span class="token operator">&lt;</span> <span class="token operator">-</span> <span class="token number">0.6</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       return<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>n <span class="token operator">&gt;</span><span class="token number">0.6</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       return<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
       return<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


changec <span class="token operator">=</span> <span class="token keyword keyword-function">function</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>n <span class="token operator">&gt;</span> <span class="token number">0.6</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        return<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
        return<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

weight <span class="token operator">=</span> <span class="token keyword keyword-function">function</span><span class="token punctuation">(</span>re<span class="token punctuation">)</span><span class="token punctuation">{</span>
    re <span class="token operator">=</span> ran<span class="token punctuation">(</span>re<span class="token punctuation">)</span>
    return<span class="token punctuation">(</span>apply<span class="token punctuation">(</span>re<span class="token punctuation">,</span>c<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>change<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

weightc <span class="token operator">=</span> <span class="token keyword keyword-function">function</span><span class="token punctuation">(</span>re<span class="token punctuation">,</span>gama<span class="token punctuation">)</span><span class="token punctuation">{</span>
    w <span class="token operator">=</span> re <span class="token operator">*</span> <span class="token number">0</span>
    j <span class="token operator">=</span> dim<span class="token punctuation">(</span>re<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
    t <span class="token operator">=</span> dim<span class="token punctuation">(</span>re<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    w0 <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span>j <span class="token operator">*</span> <span class="token number">0</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>i <span class="token keyword keyword-in">in</span> <span class="token number">1</span><span class="token operator">:</span>t<span class="token punctuation">)</span><span class="token punctuation">{</span>
        sd <span class="token operator">=</span> sd<span class="token punctuation">(</span>re<span class="token punctuation">[</span>i<span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        h <span class="token operator">=</span> sd<span class="token operator">*</span>gama
        x <span class="token operator">=</span> t<span class="token punctuation">(</span>as.matrix<span class="token punctuation">(</span>re<span class="token punctuation">[</span>i<span class="token punctuation">,</span><span class="token punctuation">]</span> <span class="token operator">+</span> h <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">+</span>w0<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        y <span class="token operator">=</span> t<span class="token punctuation">(</span>as.matrix<span class="token punctuation">(</span>re<span class="token punctuation">[</span>i<span class="token punctuation">,</span><span class="token punctuation">]</span> <span class="token operator">-</span> h <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">+</span>w0<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        dim<span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>length<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
        dim<span class="token punctuation">(</span>y<span class="token punctuation">)</span> <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>length<span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span>
        kx <span class="token operator">=</span> ran<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
        ky <span class="token operator">=</span> ran<span class="token punctuation">(</span><span class="token operator">-</span>y<span class="token punctuation">)</span>
        wx <span class="token operator">=</span> apply<span class="token punctuation">(</span>kx<span class="token punctuation">,</span>c<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>changec<span class="token punctuation">)</span>
        wy <span class="token operator">=</span> apply<span class="token punctuation">(</span>ky<span class="token punctuation">,</span>c<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>changec<span class="token punctuation">)</span>
        w0 <span class="token operator">=</span> wx <span class="token operator">-</span> wy
        w<span class="token punctuation">[</span>i<span class="token punctuation">,</span><span class="token punctuation">]</span> <span class="token operator">=</span> w0
    <span class="token punctuation">}</span>
    return<span class="token punctuation">(</span>w<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

fact <span class="token operator">=</span> <span class="token keyword keyword-function">function</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span>mat<span class="token punctuation">)</span><span class="token punctuation">{</span>
    t <span class="token operator">=</span> dim<span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token number">1</span>
    t1 <span class="token operator">=</span> dim<span class="token punctuation">(</span>mat<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    mat1 <span class="token operator">=</span> mat<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span>t<span class="token operator">+</span>t1<span class="token operator">-</span>t<span class="token punctuation">,</span><span class="token punctuation">]</span>
    w1 <span class="token operator">=</span> w<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span>t<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">]</span>
    fact <span class="token operator">=</span> w1 <span class="token operator">*</span> <span class="token punctuation">(</span>exp<span class="token punctuation">(</span>mat1<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
    fact <span class="token operator">=</span> apply<span class="token punctuation">(</span>fact<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>sum<span class="token punctuation">)</span>
    fact <span class="token operator">=</span> log<span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">+</span>fact<span class="token operator">*</span><span class="token number">2</span><span class="token operator">/</span>apply<span class="token punctuation">(</span>abs<span class="token punctuation">(</span>w1<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>sum<span class="token punctuation">)</span><span class="token punctuation">)</span>
    return<span class="token punctuation">(</span>fact<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

pnl <span class="token operator">=</span> <span class="token keyword keyword-function">function</span><span class="token punctuation">(</span>logr<span class="token punctuation">,</span>name<span class="token punctuation">)</span><span class="token punctuation">{</span>
    t <span class="token operator">=</span> length<span class="token punctuation">(</span>logr<span class="token punctuation">)</span>
    x <span class="token operator">=</span> <span class="token number">0</span><span class="token operator">:</span>t
    y <span class="token operator">=</span> array<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>dim <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>t<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-for">for</span><span class="token punctuation">(</span>i <span class="token keyword keyword-in">in</span> <span class="token number">1</span><span class="token operator">:</span>t<span class="token punctuation">)</span><span class="token punctuation">{</span>
        y<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> y<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> exp<span class="token punctuation">(</span>logr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    png<span class="token punctuation">(</span>name<span class="token punctuation">)</span>
    plot<span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span>
    dev.off<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

factc <span class="token operator">=</span> <span class="token keyword keyword-function">function</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span>mat<span class="token punctuation">)</span><span class="token punctuation">{</span>
    t <span class="token operator">=</span> dim<span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token number">1</span>
    t1 <span class="token operator">=</span> dim<span class="token punctuation">(</span>mat<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    mat1 <span class="token operator">=</span> mat<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span>t<span class="token operator">+</span>t1<span class="token operator">-</span>t<span class="token punctuation">,</span><span class="token punctuation">]</span>
    w1 <span class="token operator">=</span> w<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span>t<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">]</span>
    fact <span class="token operator">=</span> w1 <span class="token operator">*</span> <span class="token punctuation">(</span>exp<span class="token punctuation">(</span>mat1<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
    fact <span class="token operator">=</span> apply<span class="token punctuation">(</span>fact<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>sum<span class="token punctuation">)</span>
    sumw <span class="token operator">=</span> <span class="token number">0.5</span> <span class="token operator">*</span> apply<span class="token punctuation">(</span>abs<span class="token punctuation">(</span>w1<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>sum<span class="token punctuation">)</span>
    sumd <span class="token operator">=</span> apply<span class="token punctuation">(</span>abs<span class="token punctuation">(</span>w1<span class="token operator">-</span>w<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span>t<span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> sum<span class="token punctuation">)</span>
    fact <span class="token operator">=</span> log<span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> fact<span class="token operator">/</span>sumw <span class="token operator">-</span> <span class="token number">0.0005</span><span class="token operator">*</span>sumd<span class="token operator">/</span>sumw<span class="token punctuation">)</span>
    return<span class="token punctuation">(</span>fact<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</pre><hr>
<h1 class="mume-header" id="partar">parta.r</h1>

<pre data-role="codeBlock" data-info="r" class="language-r"><span class="token comment">#used data : &apos;dat.csv&apos;</span>
<span class="token comment">#used function files : &apos;yeardat.r&apos; &apos;calculate.r&apos;</span>
<span class="token comment">#used packages : &apos;library.r&apos;</span>

<span class="token comment">#set up evironment</span>
source<span class="token punctuation">(</span><span class="token string">&apos;library.r&apos;</span><span class="token punctuation">)</span>
source<span class="token punctuation">(</span><span class="token string">&apos;yeardat.r&apos;</span><span class="token punctuation">)</span>
source<span class="token punctuation">(</span><span class="token string">&apos;calculate.r&apos;</span><span class="token punctuation">)</span>

<span class="token comment">#read data</span>
dat <span class="token operator">=</span> read.csv<span class="token punctuation">(</span><span class="token string">&apos;dat.csv&apos;</span><span class="token punctuation">)</span>

<span class="token comment">#initial the yearly betameans and their t-states</span>
tsv <span class="token operator">=</span> <span class="token number">10</span><span class="token operator">:</span><span class="token number">21</span> <span class="token operator">*</span> <span class="token number">0</span>
tsm <span class="token operator">=</span> tsv 
tlist <span class="token operator">=</span> <span class="token number">10</span><span class="token operator">:</span><span class="token number">21</span>
mbv <span class="token operator">=</span> tsv 
mbm <span class="token operator">=</span> tsv 

<span class="token comment">#for every year from 2010 Jan to 2021 May</span>
<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>i <span class="token keyword keyword-in">in</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">12</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">#choose a year</span>
   t <span class="token operator">=</span> tlist<span class="token punctuation">[</span>i<span class="token punctuation">]</span>

   <span class="token comment">#find this years&apos; data </span>
   year <span class="token operator">=</span> yearly<span class="token punctuation">(</span>dat <span class="token punctuation">,</span> t<span class="token punctuation">)</span>

   <span class="token comment">#get the factor v</span>
   logr <span class="token operator">=</span> logreturn<span class="token punctuation">(</span>year<span class="token punctuation">)</span>
   logr10 <span class="token operator">=</span> app<span class="token punctuation">(</span>logr<span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span>mean<span class="token punctuation">)</span>
   logr_idu <span class="token operator">=</span> minus<span class="token punctuation">(</span>logr10<span class="token punctuation">)</span>
   sd21 <span class="token operator">=</span> app<span class="token punctuation">(</span>logr<span class="token punctuation">,</span><span class="token number">21</span><span class="token punctuation">,</span>sd<span class="token punctuation">)</span>
   v <span class="token operator">=</span> mat<span class="token punctuation">(</span>logr_idu<span class="token punctuation">)</span><span class="token operator">/</span>mat<span class="token punctuation">(</span>sd21<span class="token punctuation">)</span>
   v <span class="token operator">=</span> ran<span class="token punctuation">(</span>v<span class="token punctuation">)</span>

   <span class="token comment">#get the factor m </span>
   logrm_idu <span class="token operator">=</span> minus<span class="token punctuation">(</span>logr<span class="token punctuation">)</span>
   max21 <span class="token operator">=</span> app<span class="token punctuation">(</span>logrm_idu<span class="token punctuation">,</span><span class="token number">21</span><span class="token punctuation">,</span>max<span class="token punctuation">)</span>
   m <span class="token operator">=</span> ran<span class="token punctuation">(</span>mat<span class="token punctuation">(</span>max21<span class="token punctuation">)</span><span class="token punctuation">)</span>

   <span class="token comment">#calculate the daily betas</span>
   r_midu <span class="token operator">=</span> app<span class="token punctuation">(</span>logrm_idu<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>max<span class="token punctuation">)</span>
   beta <span class="token operator">=</span> regr<span class="token punctuation">(</span>mat<span class="token punctuation">(</span>r_midu<span class="token punctuation">)</span><span class="token punctuation">,</span>v<span class="token punctuation">,</span>m<span class="token punctuation">)</span>
   beta_v <span class="token operator">=</span> beta<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">]</span>
   beta_m <span class="token operator">=</span> beta<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">]</span>

   <span class="token comment">#save the means and the t-states</span>
   mbv<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> mean<span class="token punctuation">(</span>beta_v<span class="token punctuation">)</span>
   mbm<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> mean<span class="token punctuation">(</span>beta_m<span class="token punctuation">)</span>
   tsv<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> t_s<span class="token punctuation">(</span>beta_v<span class="token punctuation">)</span>
   tsm<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> t_s<span class="token punctuation">(</span>beta_m<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">#save the result to a .csv file &apos;beta.csv&apos;</span>
t <span class="token operator">=</span> as.data.frame<span class="token punctuation">(</span>cbind<span class="token punctuation">(</span>tlist<span class="token punctuation">,</span>mbv<span class="token punctuation">,</span>mbm<span class="token punctuation">,</span>tsv<span class="token punctuation">,</span>tsm<span class="token punctuation">)</span><span class="token punctuation">)</span>
write.csv<span class="token punctuation">(</span>t<span class="token punctuation">,</span><span class="token string">&apos;beta.csv&apos;</span><span class="token punctuation">)</span>

png<span class="token punctuation">(</span><span class="token string">&apos;beta.png&apos;</span><span class="token punctuation">)</span>
p <span class="token operator">=</span> read.csv<span class="token punctuation">(</span><span class="token string">&quot;beta.csv&quot;</span><span class="token punctuation">)</span>

par<span class="token punctuation">(</span>mfrow <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword keyword-for">for</span><span class="token punctuation">(</span>i <span class="token keyword keyword-in">in</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    names<span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span>
    plot<span class="token punctuation">(</span>p<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>p<span class="token punctuation">[</span><span class="token punctuation">,</span>i<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>ylab <span class="token operator">=</span> names<span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>xlab <span class="token operator">=</span> <span class="token string">&apos;year 20xx&apos;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
dev.off<span class="token punctuation">(</span><span class="token punctuation">)</span>
</pre><hr>
<h1 class="mume-header" id="partbr">partb.r</h1>

<pre data-role="codeBlock" data-info="r" class="language-r"><span class="token comment">#used data : &apos;dat.csv&apos;</span>
<span class="token comment">#used function files : &apos;yeardat.r&apos; &apos;calculate.r&apos;</span>
<span class="token comment">#used packages : &apos;library.r&apos;</span>

<span class="token comment">#set up evironment</span>
source<span class="token punctuation">(</span><span class="token string">&apos;library.r&apos;</span><span class="token punctuation">)</span>
source<span class="token punctuation">(</span><span class="token string">&apos;yeardat.r&apos;</span><span class="token punctuation">)</span>
source<span class="token punctuation">(</span><span class="token string">&apos;calculate.r&apos;</span><span class="token punctuation">)</span>

<span class="token comment">#read data</span>
dat <span class="token operator">=</span> read.csv<span class="token punctuation">(</span><span class="token string">&apos;dat.csv&apos;</span><span class="token punctuation">)</span>
beta <span class="token operator">=</span> read.csv<span class="token punctuation">(</span><span class="token string">&apos;beta.csv&apos;</span><span class="token punctuation">)</span>

<span class="token comment">#initial the yearly betameans and their t-states</span>
logr_year <span class="token operator">=</span> <span class="token number">10</span><span class="token operator">:</span><span class="token number">21</span> <span class="token operator">*</span> <span class="token number">0</span>
sd_year <span class="token operator">=</span> <span class="token number">10</span><span class="token operator">:</span><span class="token number">21</span> <span class="token operator">*</span> <span class="token number">0</span>
sharp  <span class="token operator">=</span>  <span class="token number">10</span><span class="token operator">:</span><span class="token number">21</span> <span class="token operator">*</span> <span class="token number">0</span>
tlist <span class="token operator">=</span> <span class="token number">10</span><span class="token operator">:</span><span class="token number">21</span>
rf_day <span class="token operator">=</span> array<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>dim <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">#for every year from 2010 Jan to 2021 May</span>
<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>i <span class="token keyword keyword-in">in</span> <span class="token number">11</span><span class="token operator">:</span><span class="token number">21</span> <span class="token operator">-</span> <span class="token number">9</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">#choose a year</span>
   t <span class="token operator">=</span> tlist<span class="token punctuation">[</span>i<span class="token punctuation">]</span>

   <span class="token comment">#find this years&apos; data </span>
   year <span class="token operator">=</span> yearly<span class="token punctuation">(</span>dat <span class="token punctuation">,</span> t<span class="token punctuation">)</span>

   <span class="token comment">#get the factor v</span>
   logr <span class="token operator">=</span> logreturn<span class="token punctuation">(</span>year<span class="token punctuation">)</span>
   logr10 <span class="token operator">=</span> app<span class="token punctuation">(</span>logr<span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span>mean<span class="token punctuation">)</span>
   logr_idu <span class="token operator">=</span> minus<span class="token punctuation">(</span>logr10<span class="token punctuation">)</span>
   sd21 <span class="token operator">=</span> app<span class="token punctuation">(</span>logr<span class="token punctuation">,</span><span class="token number">21</span><span class="token punctuation">,</span>sd<span class="token punctuation">)</span>
   v <span class="token operator">=</span> mata<span class="token punctuation">(</span>logr_idu<span class="token punctuation">)</span><span class="token operator">/</span>mata<span class="token punctuation">(</span>sd21<span class="token punctuation">)</span>
   v <span class="token operator">=</span> ran<span class="token punctuation">(</span>v<span class="token punctuation">)</span>

   <span class="token comment">#get the factor m </span>
   logrm_idu <span class="token operator">=</span> minus<span class="token punctuation">(</span>logr<span class="token punctuation">)</span>
   max21 <span class="token operator">=</span> app<span class="token punctuation">(</span>logrm_idu<span class="token punctuation">,</span><span class="token number">21</span><span class="token punctuation">,</span>max<span class="token punctuation">)</span>
   m <span class="token operator">=</span> ran<span class="token punctuation">(</span>mata<span class="token punctuation">(</span>max21<span class="token punctuation">)</span><span class="token punctuation">)</span>

   <span class="token comment">#calculate the daily logreturn in fact</span>
   beta <span class="token operator">=</span> read.csv<span class="token punctuation">(</span><span class="token string">&apos;beta.csv&apos;</span><span class="token punctuation">)</span><span class="token punctuation">[</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">]</span>
   re <span class="token operator">=</span> expect<span class="token punctuation">(</span>beta<span class="token punctuation">,</span>v<span class="token punctuation">,</span>m<span class="token punctuation">)</span>
   w <span class="token operator">=</span> weight<span class="token punctuation">(</span>re<span class="token punctuation">)</span>
   rf <span class="token operator">=</span> fact<span class="token punctuation">(</span>w<span class="token punctuation">,</span>mat<span class="token punctuation">(</span>logr<span class="token punctuation">)</span><span class="token punctuation">)</span>
   

   <span class="token comment">#save the means and the t-states</span>
    sd_year<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> sd<span class="token punctuation">(</span>rf<span class="token punctuation">)</span>
    logr_year<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> sum<span class="token punctuation">(</span>rf<span class="token punctuation">)</span>
    sharp<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> mean<span class="token punctuation">(</span>rf<span class="token punctuation">)</span><span class="token operator">/</span>sd<span class="token punctuation">(</span>rf<span class="token punctuation">)</span>
    rf_day<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span>length<span class="token punctuation">(</span>rf<span class="token punctuation">)</span><span class="token punctuation">,</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> rf 
<span class="token punctuation">}</span>

<span class="token comment">#save the result to a .csv file </span>
fact <span class="token operator">=</span> as.data.frame<span class="token punctuation">(</span>cbind<span class="token punctuation">(</span>tlist<span class="token punctuation">,</span>logr_year<span class="token punctuation">,</span>sd_year<span class="token punctuation">,</span>sharp<span class="token punctuation">)</span><span class="token punctuation">)</span>
write.csv<span class="token punctuation">(</span>fact<span class="token punctuation">,</span><span class="token string">&apos;return.csv&apos;</span><span class="token punctuation">)</span>
write.csv<span class="token punctuation">(</span>as.data.frame<span class="token punctuation">(</span>rf_day<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&apos;dailyreturn.csv&apos;</span><span class="token punctuation">)</span>
</pre><hr>
<h1 class="mume-header" id="partbcr">partbc.r</h1>

<pre data-role="codeBlock" data-info="r" class="language-r"><span class="token comment">#used data : &apos;dat.csv&apos;</span>
<span class="token comment">#used function files : &apos;yeardat.r&apos; &apos;calculate.r&apos;</span>
<span class="token comment">#used packages : &apos;library.r&apos;</span>

<span class="token comment">#set up evironment</span>
source<span class="token punctuation">(</span><span class="token string">&apos;library.r&apos;</span><span class="token punctuation">)</span>
source<span class="token punctuation">(</span><span class="token string">&apos;yeardat.r&apos;</span><span class="token punctuation">)</span>
source<span class="token punctuation">(</span><span class="token string">&apos;calculate.r&apos;</span><span class="token punctuation">)</span>

<span class="token comment">#read data</span>
dat <span class="token operator">=</span> read.csv<span class="token punctuation">(</span><span class="token string">&apos;dat.csv&apos;</span><span class="token punctuation">)</span>
beta <span class="token operator">=</span> read.csv<span class="token punctuation">(</span><span class="token string">&apos;beta.csv&apos;</span><span class="token punctuation">)</span>

<span class="token comment">#initial the yearly betameans and their t-states</span>
logr_year <span class="token operator">=</span> <span class="token number">10</span><span class="token operator">:</span><span class="token number">21</span> <span class="token operator">*</span> <span class="token number">0</span>
sd_year <span class="token operator">=</span> <span class="token number">10</span><span class="token operator">:</span><span class="token number">21</span> <span class="token operator">*</span> <span class="token number">0</span>
sharp  <span class="token operator">=</span>  <span class="token number">10</span><span class="token operator">:</span><span class="token number">21</span> <span class="token operator">*</span> <span class="token number">0</span>
tlist <span class="token operator">=</span> <span class="token number">10</span><span class="token operator">:</span><span class="token number">21</span>
rf_day <span class="token operator">=</span> array<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>dim <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">#for every year from 2010 Jan to 2021 May</span>
<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>i <span class="token keyword keyword-in">in</span> <span class="token number">11</span><span class="token operator">:</span><span class="token number">21</span> <span class="token operator">-</span> <span class="token number">9</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">#choose a year</span>
   t <span class="token operator">=</span> tlist<span class="token punctuation">[</span>i<span class="token punctuation">]</span>

   <span class="token comment">#find this years&apos; data </span>
   year <span class="token operator">=</span> yearly<span class="token punctuation">(</span>dat <span class="token punctuation">,</span> t<span class="token punctuation">)</span>

   <span class="token comment">#get the factor v</span>
   logr <span class="token operator">=</span> logreturn<span class="token punctuation">(</span>year<span class="token punctuation">)</span>
   logr10 <span class="token operator">=</span> app<span class="token punctuation">(</span>logr<span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span>mean<span class="token punctuation">)</span>
   logr_idu <span class="token operator">=</span> minus<span class="token punctuation">(</span>logr10<span class="token punctuation">)</span>
   sd21 <span class="token operator">=</span> app<span class="token punctuation">(</span>logr<span class="token punctuation">,</span><span class="token number">21</span><span class="token punctuation">,</span>sd<span class="token punctuation">)</span>
   v <span class="token operator">=</span> mata<span class="token punctuation">(</span>logr_idu<span class="token punctuation">)</span><span class="token operator">/</span>mata<span class="token punctuation">(</span>sd21<span class="token punctuation">)</span>
   v <span class="token operator">=</span> ran<span class="token punctuation">(</span>v<span class="token punctuation">)</span>

   <span class="token comment">#get the factor m </span>
   logrm_idu <span class="token operator">=</span> minus<span class="token punctuation">(</span>logr<span class="token punctuation">)</span>
   max21 <span class="token operator">=</span> app<span class="token punctuation">(</span>logrm_idu<span class="token punctuation">,</span><span class="token number">21</span><span class="token punctuation">,</span>max<span class="token punctuation">)</span>
   m <span class="token operator">=</span> ran<span class="token punctuation">(</span>mata<span class="token punctuation">(</span>max21<span class="token punctuation">)</span><span class="token punctuation">)</span>

   <span class="token comment">#calculate the daily logreturn in fact</span>
   beta <span class="token operator">=</span> read.csv<span class="token punctuation">(</span><span class="token string">&apos;beta.csv&apos;</span><span class="token punctuation">)</span><span class="token punctuation">[</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">]</span>
   re <span class="token operator">=</span> expect<span class="token punctuation">(</span>beta<span class="token punctuation">,</span>v<span class="token punctuation">,</span>m<span class="token punctuation">)</span>
   w <span class="token operator">=</span> weight<span class="token punctuation">(</span>re<span class="token punctuation">)</span>
   rf <span class="token operator">=</span> factc<span class="token punctuation">(</span>w<span class="token punctuation">,</span>mat<span class="token punctuation">(</span>logr<span class="token punctuation">)</span><span class="token punctuation">)</span>
   

   <span class="token comment">#save the means and the t-states</span>
    sd_year<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> sd<span class="token punctuation">(</span>rf<span class="token punctuation">)</span>
    logr_year<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> sum<span class="token punctuation">(</span>rf<span class="token punctuation">)</span>
    sharp<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> mean<span class="token punctuation">(</span>rf<span class="token punctuation">)</span><span class="token operator">/</span>sd<span class="token punctuation">(</span>rf<span class="token punctuation">)</span>
    rf_day<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span>length<span class="token punctuation">(</span>rf<span class="token punctuation">)</span><span class="token punctuation">,</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> rf 
<span class="token punctuation">}</span>

<span class="token comment">#save the result to a .csv file </span>
fact <span class="token operator">=</span> as.data.frame<span class="token punctuation">(</span>cbind<span class="token punctuation">(</span>tlist<span class="token punctuation">,</span>logr_year<span class="token punctuation">,</span>sd_year<span class="token punctuation">,</span>sharp<span class="token punctuation">)</span><span class="token punctuation">)</span>
write.csv<span class="token punctuation">(</span>fact<span class="token punctuation">,</span><span class="token string">&apos;returnc.csv&apos;</span><span class="token punctuation">)</span>
write.csv<span class="token punctuation">(</span>as.data.frame<span class="token punctuation">(</span>rf_day<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&apos;dailyreturnc.csv&apos;</span><span class="token punctuation">)</span>


dat <span class="token operator">=</span> as.matrix<span class="token punctuation">(</span>read.csv<span class="token punctuation">(</span><span class="token string">&apos;dailyreturnc.csv&apos;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">224</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token operator">:</span><span class="token number">13</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
dim<span class="token punctuation">(</span>dat<span class="token punctuation">)</span> <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">224</span><span class="token operator">*</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
pnl<span class="token punctuation">(</span>dat<span class="token punctuation">,</span><span class="token string">&apos;pnlcostc.png&apos;</span><span class="token punctuation">)</span>
</pre><hr>
<h1 class="mume-header" id="partcr">partc.r</h1>

<pre data-role="codeBlock" data-info="r" class="language-r"><span class="token comment">#used data : &apos;dat.csv&apos;</span>
<span class="token comment">#used function files : &apos;yeardat.r&apos; &apos;calculate.r&apos;</span>
<span class="token comment">#used packages : &apos;library.r&apos;</span>

<span class="token comment">#set up evironment</span>
source<span class="token punctuation">(</span><span class="token string">&apos;library.r&apos;</span><span class="token punctuation">)</span>
source<span class="token punctuation">(</span><span class="token string">&apos;yeardat.r&apos;</span><span class="token punctuation">)</span>
source<span class="token punctuation">(</span><span class="token string">&apos;calculate.r&apos;</span><span class="token punctuation">)</span>

<span class="token comment">#read data</span>
dat <span class="token operator">=</span> read.csv<span class="token punctuation">(</span><span class="token string">&apos;dat.csv&apos;</span><span class="token punctuation">)</span>
beta <span class="token operator">=</span> read.csv<span class="token punctuation">(</span><span class="token string">&apos;beta.csv&apos;</span><span class="token punctuation">)</span>

<span class="token comment">#initial the yearly betameans and their t-states</span>
<span class="token comment">#logr_year = 10:21 * 0</span>
<span class="token comment">#sd_year = 10:21 * 0</span>
<span class="token comment">#sharp  =  10:21 * 0</span>
tlist <span class="token operator">=</span> <span class="token number">10</span><span class="token operator">:</span><span class="token number">21</span>
glist <span class="token operator">=</span> <span class="token number">11</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">/</span><span class="token number">10</span>
rf_day <span class="token operator">=</span> array<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>dim <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword keyword-for">for</span><span class="token punctuation">(</span>gama <span class="token keyword keyword-in">in</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    g <span class="token operator">=</span>glist<span class="token punctuation">[</span>gama<span class="token punctuation">]</span> 
    <span class="token comment">#for every year from 2010 Jan to 2021 May</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>i <span class="token keyword keyword-in">in</span> <span class="token number">11</span><span class="token operator">:</span><span class="token number">21</span> <span class="token operator">-</span> <span class="token number">9</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">#choose a year</span>
        t <span class="token operator">=</span> tlist<span class="token punctuation">[</span>i<span class="token punctuation">]</span>

        <span class="token comment">#find this years&apos; data </span>
        year <span class="token operator">=</span> yearly<span class="token punctuation">(</span>dat <span class="token punctuation">,</span> t<span class="token punctuation">)</span>

        <span class="token comment">#get the factor v</span>
        logr <span class="token operator">=</span> logreturn<span class="token punctuation">(</span>year<span class="token punctuation">)</span>
        logr10 <span class="token operator">=</span> app<span class="token punctuation">(</span>logr<span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span>mean<span class="token punctuation">)</span>
        logr_idu <span class="token operator">=</span> minus<span class="token punctuation">(</span>logr10<span class="token punctuation">)</span>
        sd21 <span class="token operator">=</span> app<span class="token punctuation">(</span>logr<span class="token punctuation">,</span><span class="token number">21</span><span class="token punctuation">,</span>sd<span class="token punctuation">)</span>
        v <span class="token operator">=</span> mata<span class="token punctuation">(</span>logr_idu<span class="token punctuation">)</span><span class="token operator">/</span>mata<span class="token punctuation">(</span>sd21<span class="token punctuation">)</span>
        v <span class="token operator">=</span> ran<span class="token punctuation">(</span>v<span class="token punctuation">)</span>

        <span class="token comment">#get the factor m </span>
        logrm_idu <span class="token operator">=</span> minus<span class="token punctuation">(</span>logr<span class="token punctuation">)</span>
        max21 <span class="token operator">=</span> app<span class="token punctuation">(</span>logrm_idu<span class="token punctuation">,</span><span class="token number">21</span><span class="token punctuation">,</span>max<span class="token punctuation">)</span>
        m <span class="token operator">=</span> ran<span class="token punctuation">(</span>mata<span class="token punctuation">(</span>max21<span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token comment">#calculate the daily logreturn in fact</span>
        beta <span class="token operator">=</span> read.csv<span class="token punctuation">(</span><span class="token string">&apos;beta.csv&apos;</span><span class="token punctuation">)</span><span class="token punctuation">[</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">]</span>
        re <span class="token operator">=</span> expect<span class="token punctuation">(</span>beta<span class="token punctuation">,</span>v<span class="token punctuation">,</span>m<span class="token punctuation">)</span>
        w <span class="token operator">=</span> weightc<span class="token punctuation">(</span>re<span class="token punctuation">,</span>g<span class="token punctuation">)</span>
        rf <span class="token operator">=</span> factc<span class="token punctuation">(</span>w<span class="token punctuation">,</span>mat<span class="token punctuation">(</span>logr<span class="token punctuation">)</span><span class="token punctuation">)</span>
        

        <span class="token comment">#save the means and the t-states</span>
        rf_day<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span>length<span class="token punctuation">(</span>rf<span class="token punctuation">)</span><span class="token punctuation">,</span>i<span class="token punctuation">,</span>gama<span class="token punctuation">]</span> <span class="token operator">=</span> rf 
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

png<span class="token punctuation">(</span><span class="token string">&quot;pnl9.png&quot;</span><span class="token punctuation">)</span>
par<span class="token punctuation">(</span>mfrow <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword keyword-for">for</span><span class="token punctuation">(</span>i <span class="token keyword keyword-in">in</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    logr <span class="token operator">=</span> rf_day<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">224</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token operator">:</span><span class="token number">12</span><span class="token punctuation">,</span>i<span class="token punctuation">]</span>
    dim<span class="token punctuation">(</span>logr<span class="token punctuation">)</span> <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">224</span><span class="token operator">*</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
    t <span class="token operator">=</span> length<span class="token punctuation">(</span>logr<span class="token punctuation">)</span>
    x <span class="token operator">=</span> <span class="token number">0</span><span class="token operator">:</span>t
    y <span class="token operator">=</span> array<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>dim <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>t<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-for">for</span><span class="token punctuation">(</span>i <span class="token keyword keyword-in">in</span> <span class="token number">1</span><span class="token operator">:</span>t<span class="token punctuation">)</span><span class="token punctuation">{</span>
        y<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> y<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> exp<span class="token punctuation">(</span>logr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    plot<span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
dev.off<span class="token punctuation">(</span><span class="token punctuation">)</span>

</pre>
      </div>
      
      
    
    
    
    
    
    
    
    
  
    </body></html>